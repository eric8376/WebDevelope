
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>大客户列表</title>
</head>
<link rel="stylesheet" type="text/css" href="../../style/base.css" />
<link type="text/css" rel="stylesheet" href="../../inc/xtree/xtree.css">
<script src="../../inc/xtree/xtree.js"></script>
<script language="javascript" src="../../inc/json/json.js"></script>
<script language="javascript" src="../../inc/js/string.js"></script>
<style>
html, body {
  height:100%;
  margin: 0;
  padding: 0;
  border: none;
  font-size:12px;
  overflow:hidden;
}
.button_blue{margin:1 2 1 2; border-right:1 solid #5AA9FF; border-top:1 solid #FFFFFF; border-left:1 solid #FFFFFF; border-bottom:1 solid #5AA9FF; font-size:12px; color:#003399; padding-top:2; background:#BDE5FF;}
</style>

<body onload="init()" scroll="no" style="background-color: #F8F3F7;">
<div id="coverdiv"  style="z-index:1000;filter:alpha(opacity=30);Opacity:0.3; background-color:#F8F4E2; position:absolute; left:0px; top:0px;width:100%;height:98%"></div>
<div id="coverdiv-loading" style="z-index:1001; position:absolute; left:20px; top:200px;"><img src="../../images/loading.gif"/>数据加载...</div>
<div style="width:100%;text-align:center;"><a href="javascript:prePageQuery()">前一页</a><span id="nowPageIndex"></span>/<span id="totalPageNum"></span><a href="javascript:nextPageQuery()">后一页</a><span></span></div>
<div id="queryDiv" style="width:100%">
<table>
 <tr>
 <!-- <td>名称</td><td><input id="cust_name">&nbsp;&nbsp;<a href="javascript:init()">查询</a></td>-->
 
 <td>名称:</td><td><input id="cust_name">&nbsp;<input style='width:35px;align:right' class="button_blue" type="button" id="queryBtn" value='查询' onclick="initQuery();"></td>
 </tr>
</table>
</div>
<HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="80%" color=#987cb9 SIZE=3>
<div id="treeDiv" style="width: 95%; height:80%; padding: 5px; overflow: auto;border:10px;">

</body>
</html>
<script>
 window.onresize = function(){
 
document.getElementById("treeDiv").style.height=(document.body.clientHeight-65)+"px";
document.getElementById("treeDiv").style.width="100%";
}
setWebFXTreeRootPath("../../inc/xtree/");
var custTree =  new WebFXTree("大客户列表");
document.getElementById("treeDiv").innerHTML = custTree.toHTML().toString();
var _pageCount=0;
var _pageIndex=1;
var _pageSize="30";//20
var _custMap;
//scrollHeight

document.getElementById("treeDiv").style.height=(document.body.clientHeight-65)+"px";

function initQuery(){
	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].initCustShow();
	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=0;
  	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("totalPageNum").innerHTML=0+"[0]";	 
	 init();
}

function init(){
 coverdivIsShow(true);
 var serviceCall = new ServiceCall(true,initTree);
 var obj=new Object();
 obj.advQueryC=" parent_id is null  and consume_level='1' and delete_state='0'";
 if(getCondition().length>0)
  obj.advQueryC=" parent_id is null  and consume_level='1' and delete_state='0' and "+getCondition()+" ";
 obj.treeLevel="1";
 obj.pageIndex="1";
 obj.pageSize=_pageSize;
 obj.pageCount="-1";
 obj.orderBy=" cust_name "
 serviceCall.init("queryCustCirSvc");
 serviceCall.execute(obj);
  
 
}
function showLogo(custMap){
	if(custMap==null) return;
	var test=1;
	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].getCustMap(custMap);
	 
}
function showLogoInit(){
	if(_custMap==null) return;
	if(typeof(window.parent.frames['rfefFrame'].frames["tuopFrame4"])=='undefined'){
	setTimeout("showLogoInit",500);
	return;
	}
	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].getCustMap(_custMap);
	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=_pageIndex;
  	 window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("totalPageNum").innerHTML=_pageCount+"["+_custMap.recordCount+"]";
	 
}

function initTree(custMap){
custTree.remove();
_pageCount=custMap.pageCount;
_pageIndex=1;
if(_pageCount==0)_pageIndex=0;
 document.getElementById("nowPageIndex").innerHTML=_pageIndex;
 document.getElementById("totalPageNum").innerHTML=_pageCount+"["+custMap.recordCount+"]";
 //alert("custMap="+custMap);
 //arrayNode =new Array[];
 if(custMap.list &&　custMap.list.length>0){
   for(i=0;i<custMap.list.length;i++){
    var item = custMap.list[i];
   // alert(JSON.stringify(custMap.list[i]));
    if(item.custName.trim().length<=0)continue;
    if(item.grade=="3"){
      item.addPerfPic="../../images/btn/Diamond.png";
    }
   var a = new WebFXTreeItem(item.custName+"["+item.cirCount+"]","javascript:showChild();showContent();",null,item);
   custTree.add(a);
  // arrayNode[i+3]
   }
   //selectNode();
  // showFromLog(4);
   //webFXTreeHandler.select(a);
  // setTimeout("showLogoInit()",500); 
  //showLogo(custMap);
  _custMap=custMap;
  showLogoInit()
 }
 coverdivIsShow(false);
}
function showFromLog(num){
 //alert("showFromLog="+num);
  coverdivIsShow(true);
selectNode(num);
}
function selectNode(num){
var ii=0;
	//while(ii<5){alert(ii);ii++;if(ii==3)break;}
	webFXTreeHandler.select(webFXTreeHandler.all["webfx-tree-object-"+num+""]);
	//alert("pause");
	setTimeout("showSelectedNode("+num+")",500); 
	//showSelectedNode(num);
	
}
function showSelectedNode(num){
	showChildTrue();
	showContentFroLOG();
	webFXTreeHandler.all["webfx-tree-object-"+num+""].toggle();
	coverdivIsShow(false);
}
function queryCust(pageIndex){
coverdivIsShow(true);
var serviceCall2 = new ServiceCall(true,initTree2);
 var obj=new Object();
 obj.advQueryC=" parent_id is null  and consume_level='1'"; 
  if(getCondition().length>0)
  obj.advQueryC=" parent_id is null  and consume_level='1' and "+getCondition()+" ";
 obj.pageIndex=pageIndex.toString();
 obj.pageSize=_pageSize;
 obj.treeLevel="1";
 obj.orderBy=" cust_name ";
 serviceCall2.init("queryCustCirSvc");
 serviceCall2.execute(obj);


 

}
function initTree2(custMap){
webFXTreeHandler.selected=null;//解决翻页时候的 js出错 
 custTree.remove();
 if(custMap.list &&　custMap.list.length>0){
   for(i=0;i<custMap.list.length;i++){
    var item = custMap.list[i];
    if(item.custName.trim().length<=0)continue;
    if(item.grade=="3"){
      item.addPerfPic="../../images/btn/Diamond.png";
    }
   var a = new WebFXTreeItem(item.custName+"["+item.cirCount+"]","javascript:showChild();showContent();",null,item);
   custTree.add(a);
   }
   showLogo(custMap);
 }
 coverdivIsShow(false);
}
function showChild(){
//alert('child');
var selectItem = custTree.getSelected();
 if(selectItem==null) return;
 if(!selectItem.childNodes ||  selectItem.childNodes.length<=0){
 	coverdivIsShow(true);
 	setTimeout("showChildTrue()",500); 
 }

}
function showChildTrue(){


 var selectItem = custTree.getSelected();
 if(selectItem==null) return;
 if(!selectItem.childNodes ||  selectItem.childNodes.length<=0){
 var serviceCall3 = new ServiceCall();
 serviceCall3.init("queryCustCirSvc");
//	alert(JSON.stringify(selectItem.data));
 if(selectItem.data.dataType=="1"){
  selectItem.data.buzType=selectItem.data.custName;
 }
 var childItems=serviceCall3.execute(selectItem.data);
//alert(childItems.list.length);
 if(childItems && childItems.list &&　childItems.list.length>0){
   for(i=0;i<childItems.list.length;i++){
    var item = childItems.list[i];
    var treeItemName = item.custName+"["+item.cirCount+"]";
   if(item.dataType=="2") treeItemName = item.custName;
   var a = new WebFXTreeItem(treeItemName,"javascript:showChild();showContent();",null,item);
   selectItem.add(a);
   }
 }
 
// alert("selectItem.data.dataType1="+selectItem.data.dataType);
 if(typeof(selectItem.data.dataType)!="undefined"&&false){
 //alert("here");
 var serviceCall4 = new ServiceCall(true,initTree3);
 serviceCall4.init("queryCustCirSvc");
 var obj=new Object();
 obj.advQueryC=" parent_id ='"+selectItem.data.custId+"'"; 
 obj.pageIndex="1";
 obj.pageSize="10000";
 obj.treeLevel="1";
  serviceCall4.execute(obj);
 }else{
 coverdivIsShow(false);
 }
 
 }
 //alert(" finish in chile");
}
function initTree3(childItems){
var selectItem = custTree.getSelected();
 if(childItems.list &&　childItems.list.length>0){
   for(i=0;i<childItems.list.length;i++){
    var item = childItems.list[i];
    var treeItemName = item.custName+"["+item.cirCount+"]";
   if(item.dataType=="2") treeItemName = item.custName;
   var a = new WebFXTreeItem(treeItemName,"javascript:showChild();showContent();",null,item);
   selectItem.add(a);
 
   }
 }
 coverdivIsShow(false);
 
}
function showContentFroLOG(){
 var selectItem = custTree.getSelected();
 if(selectItem==null) return;
 window.parent.frames['rfefFrame'].initTabFroLOG(selectItem.data);
}
 function showContent(custInfo){
 var selectItem = custTree.getSelected();
//alert("showContent,selectItem.data="+JSON.stringify(selectItem.data));
 if(selectItem==null) return;
 if(selectItem.data.buzType=='_ALL_TYPE_CIR')window.parent.frames['rfefFrame'].initTabFroLOG(selectItem.data);
 else window.parent.frames['rfefFrame'].initTab(selectItem.data);

 }
 function prePageQueryFromlogo(_pageIndexlogo){
 _pageIndexlogo=_pageIndexlogo-1;
 if(_pageIndex<1) {
  _pageIndex=1;
  return;
 }
 document.getElementById("nowPageIndex").innerHTML=_pageIndex;
  window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=_pageIndex;
 queryCust(_pageIndex);
}
function nextPageQueryFromlogo(){
_pageIndex=_pageIndex+1;
 if(_pageIndex>_pageCount) 
  {
  _pageIndex=_pageCount;
  return;
  }
 document.getElementById("nowPageIndex").innerHTML=_pageIndex;
  window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=_pageIndex;
 queryCust(_pageIndex);
}
function prePageQuery(){
 _pageIndex=_pageIndex-1;
 if(_pageIndex<1) {
  _pageIndex=1;
  return;
 }
 document.getElementById("nowPageIndex").innerHTML=_pageIndex;
  window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=_pageIndex;
 queryCust(_pageIndex);
}
function nextPageQuery(){
_pageIndex=_pageIndex+1;
 if(_pageIndex>_pageCount) 
  {
  _pageIndex=_pageCount;
  return;
  }
 document.getElementById("nowPageIndex").innerHTML=_pageIndex;
  window.parent.frames['rfefFrame'].frames["tuopFrame4"].document.getElementById("nowPageIndex").innerHTML=_pageIndex;
 queryCust(_pageIndex);
}
function getCondition(){
//alert("begin getConditio");
  var condition="";
  if(document.getElementById("cust_name").value.trim().length>0)
    condition=" lower(cust_name) like '%"+document.getElementById("cust_name").value.trim().toLowerCase()+"%'";
// alert("begin getConditio");
  return condition;  
}
function coverdivIsShow(isShow){
 if(typeof(isShow)=="undefined"||isShow==null||isShow==false){
  document.getElementById("coverdiv").style.display="none";
  document.getElementById("coverdiv-loading").style.display="none";
 }else{
 //alert("begin cover");
  document.getElementById("coverdiv").style.display="block";
  document.getElementById("coverdiv-loading").style.display="block";
  //alert("end cover");
 }
}

function getSelectedItemData(){
if(custTree==null) return null;
var selectItem = custTree.getSelected();
 if(selectItem==null) return null;
 return selectItem;
}
</script>