<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>ztesfot</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<link rel="stylesheet" type="text/css" href="../../style/base.css" />
<link rel="stylesheet" href="../../inc/tab/css/tab-view.css" type="text/css" media="screen">
<script type="text/javascript" src="../../inc/tab/js/tab-view.js"></script>
	
<script language="javascript" src="../../inc/json/json.js"></script>
<link rel="stylesheet" href="../../inc/table/table.css" type="text/css" media="screen">
<script type="text/javascript" src="../../inc/table/table.js"></script>

<style>
html, body {
  height:100%;
  margin: 0;
  padding: 0;
  border: none;
  font-size:12px;
  overflow:hidden;
}
</style>
<body onload="init()">
<div id="dhtml_tabView1"  style="width:100%;height:95%;">
	<div class="dhtmlgoodies_aTab" id="tab1">
    <div id="coverdiv"  style="display:none;z-index:1000;filter:alpha(opacity=30);Opacity:0.3; background-color:#F8F4E2; position:absolute; left:5px; top:5px;width:100%;height:100%"></div>
    <div id="coverdiv-loading" style="display:none;z-index:1001; position:absolute; left:100px; top:200px;"><img src="../../images/loading.gif"/>数据加载...</div>
	<div  id="tableDiv" style="width:100%;height:100%;"> 
	        <table   id="scrollTable"  >  
            <TR  >   
            <TD   nowrap style="width:150px" id="buzType" width="150px">业务类型</TD>   
            <TD   nowrap style="width:50px" id="oprState">状态</TD>   
            <TD   nowrap id="circuitNo" style="width:100px" width="100px">编号</TD>  
             <TD   nowrap id="rate" style="width:50px" >速率</TD> 
              <TD   nowrap id="formalCircuitNo" style="width:100px" >国际国内编码</TD> 
               <TD   nowrap id="route" style="width:600px" >路由</TD>  
           </TR>  

            </table> 

</div> 
	</div>
	<div class="dhtmlgoodies_aTab" id="tab2">
		<div  id="tableDiv2" style="width:100%;height:100%;"> 
	        <table   id="scrollTable2"  >  
	       
            <TR  > 
            <TD   nowrap style="width:150px" id="circuitNo">电路编号</TD>   
            <TD   nowrap style="width:150px" id="buzType">业务类型</TD>     
            <TD   nowrap style="width:150px" id="speciality">专业</TD>   
            <TD   nowrap style="width:200px" id="roomName">机房名称</TD>   
            <TD   nowrap  style="width:150px" id="eqpName">设备名称</TD>  
             <TD   nowrap  style="width:150px" id="eqpNo">设备编号</TD> 
           </TR>  
            </table> 

</div> 
	</div>
	<div class="dhtmlgoodies_aTab" width="100%" height="100%"id="tab3">
	 <iframe name="tuopFrame1" id="tuopFrame1" src="" frameborder=0 width="100%" height="100%" scrolling="auto"></iframe>
	</div>
	<div class="dhtmlgoodies_aTab" width="100%" height="100%"id="tab4">
	 <iframe name="tuopFrame2" id="tuopFrame2" src="" frameborder=0 width="100%" height="100%" scrolling="auto"></iframe>
	</div>
</div>
<form style="margin:0 0 0 0" method="post" name="form1" id="form1" action="/RES/PrintServlet?printId=custCirQueryPrint">
</form>
</body>
</html>
<script type="text/javascript">
var mygrid,mygrid2;
var grid,grid2;
var _last_custInfo=null;
var _tabDataExit=Array(false,false,false,false);
var _tb1,_tb2;
function initTab(custInfo){

for(i=0;i<4;i++){
_tabDataExit[i]=false;
}
_last_custInfo=custInfo;
initActiveTab();
}
function initActiveTab(){
  
  var aTab=getActiveTab();
  if(aTab==null)return;
   var tabNames = aTab.id.split("_");
  var tabIndex=tabNames[tabNames.length-1].replace(/[^0-9]/gi,'');
  if(_tabDataExit[parseInt(tabIndex)]==true)return;
  switch(parseInt(tabIndex)){
  case 0:initGrid1();break;
  case 1:initGrid2();break;
  case 2:initGrid3();break;
  case 3:initGrid4();break;   
  case 4:alert(1);    
  }
  _tabDataExit[parseInt(tabIndex)]=true;
}

function _dataItemDbClick(idstr){
			 
}
function initGrid1(){

var custInfo=_last_custInfo;
if (custInfo==null)return;

//为了只初始化一次

if(_tabDataExit[0]==true)return;
_tabDataExit[0]=true;

var custId=custInfo.custId;
var dataType=custInfo.dataType;
   
   coverdivIsShow(true);
   var serviceCall = new ServiceCall(true,initData1);
   var obj=new Object();
   if(typeof(custId)=="undefined"||custId==null||custId==""){
   obj.sql="select distinct * from vw_dat_sh_cust_cir_query ";
   }else{
   obj.sql="select distinct * from vw_dat_sh_cust_cir_query where cust_id='"+custId+"'";
   if(dataType=="1"){
     obj.sql = "select distinct * from vw_dat_sh_cust_cir_query where cust_id='"+custId+"' and buz_type='"+custInfo.custName+"' ";
   }else if(dataType=="2"){
     obj.sql="select distinct * from vw_dat_sh_cust_cir_query where circuit_id='"+custInfo.circuitId+"' and cust_id='"+custId+"'";
     
   }  
   }
   serviceCall.init("queryDataSvc");
   serviceCall.execute(obj);
}
function initData1(rt){
  
  if(rt!=null && rt.list && rt.list.length>0){
  	for(i=0;i<rt.list.length;i++){
  		rt.list[i].route="<input type='text' style='width:100%;border:1px;'  name='rout_textArea_"+i+"' id='rout_textArea_"+i+"' readonly>";
  	}
    _tb1.loadData(rt.list);
    for(i=0;i<rt.list.length;i++){
      var serviceCallR = new ServiceCall();
      serviceCallR.init("txtRouteQrySvc");
      var route=serviceCallR.execute({"resType":"circuit","resId":rt.list[i].circuitId.toString()});
      if(route!=null){
      	//alert(route);
       document.getElementById("rout_textArea_"+i).value=route.replace(/<br>/ig,'\n');
      }
    }
    //_tb1.loadData(rt.list);
    
  }else{
  _tb1.clearn();
  }
  
   coverdivIsShow(false); 
  
}

function initGrid2(){
 if(_tabDataExit[1]==false){
  _tb2=new DataGrid("tableDiv2","scrollTable2",{});
 }

  
var custInfo=_last_custInfo;
if (custInfo==null)return null;
if(_tabDataExit[1]==true)return null;
_tabDataExit[1]=true;

   var custId = custInfo.custId;
   coverdivIsShow(true);
   var serviceCall = new ServiceCall();
   var obj=new Object();
   if(typeof(custId)=="undefined"||custId==null||custId==""){
   obj.sql="select * from vw_dat_sh_cust_cir_eqp ";
   }else{
   obj.sql="select * from vw_dat_sh_cust_cir_eqp where cust_id='"+custId+"' ";
  
    if(custInfo.buzType!=null && custInfo.buzType!="_ALL_TYPE_CIR")
      obj.sql+=" and buz_type='"+custInfo.buzType+"' "; 
    if(custInfo.circuitId!=null && custInfo.circuitId.length>0)
       obj.sql+=" and circuit_Id='"+custInfo.circuitId+"' ";  
   }
   
   serviceCall.init("queryDataSvc");
   var rt= serviceCall.execute(obj);
    

   if(rt!=null && rt.list && rt.list.length>0)
    _tb2.loadData(rt.list);
    else
     _tb2.clearn();
 
   coverdivIsShow(false); 

}



function initGrid3(){
var custInfo=_last_custInfo;
if (custInfo==null)return;

//为了只初始化一次

//if(_tabDataExit[2]==true)return;
//_tabDataExit[2]=true;
  
   //if(!custInfo.dataType ||custInfo.dataType!="2") return;
   
   var serviceCall = new ServiceCall();
   var code=custInfo.custId+"*";
   if(custInfo.buzType!="_ALL_TYPE_CIR"){
   var obj=new Object();
   obj.sql="select code from pub_restriction where keyword='RENT_CIRCUIT_PROPERTY' and desc_china='"+custInfo.buzType+"'";
   serviceCall.init("queryDataSvc");
   var o= serviceCall.execute(obj); 
  
   if(o.list && o.list.length && o.list[0].code!=null){
     code=custInfo.custId+"*"+o.list[0].code;
     }
    }
    var oo=new Object();
    oo.sTopDefId="700012";
    oo.sSysLayerType="vip_room";
    oo.sResId=code;
    oo.tableSqlMap="resShCir.maplayerIdSql";
    serviceCall.init("queryForDtoSvc");
    var oo2= serviceCall.execute(oo); 
    if(oo2 && oo2.maplayerId){
     frames["tuopFrame1"].location.href ="tuopo.html?mapLayerId="+oo2.maplayerId+"&sSysLayerType=vip_room&RootId="+code+"&sTopDefId=700012&NodeParams="+code;
    
     //frames["tuopFrame1"].location.href ="tuopo.html?mapLayerId="+oo2.maplayerId;
    }else{
       frames["tuopFrame1"].location.href ="noTuopo.html";
    
    }
 
}

function initGrid4(){
var custInfo=_last_custInfo;
if (custInfo==null)return;

//为了只初始化一次

//if(_tabDataExit[3]==true)return;
//_tabDataExit[3]=true;
  
   //if(!custInfo.dataType ||custInfo.dataType!="2") return;
   
   var serviceCall = new ServiceCall();
   var code=custInfo.custId+"*";
   if(custInfo.buzType!="_ALL_TYPE_CIR"){
   var obj=new Object();
   obj.sql="select code from pub_restriction where keyword='RENT_CIRCUIT_PROPERTY' and  desc_china='"+custInfo.buzType+"'";
   serviceCall.init("queryDataSvc");
   var o= serviceCall.execute(obj); 
  
   if(o.list && o.list.length && o.list[0].code!=null){
     code=custInfo.custId+"*"+o.list[0].code;
     }
    }
    var oo=new Object();
    oo.sTopDefId="700013";
    oo.sSysLayerType="vip_ne";
    oo.sResId=code;
    oo.tableSqlMap="resShCir.maplayerIdSql";
    serviceCall.init("queryForDtoSvc");
    var oo2= serviceCall.execute(oo); 
    if(oo2 && oo2.maplayerId){
     frames["tuopFrame2"].location.href ="tuopo.html?mapLayerId="+oo2.maplayerId+"&sSysLayerType=vip_ne&RootId="+code+"&sTopDefId=700013&NodeParams="+code;
    
 //    frames["tuopFrame2"].location.href ="tuopo.html?mapLayerId="+oo2.maplayerId;
    }else{
       frames["tuopFrame2"].location.href ="noTuopo.html";
    
    }    
    

 }
function init(){	
    setPrefDir("../../inc/tab/");
    var height0 = document.body.parentElement.clientHeight-30;
    initTabs('dhtml_tabView1',Array('电路列表','两端设备列表','机房拓扑图','传输网元拓扑图'),0,"98%","95%",null,null,Array(initGrid1,initGrid2,initGrid3,initGrid4));
 
     var aTab = document.createElement('DIV');
    aTab.className='tabInactive';
    aTab.onclick = function(){printData();};
    dhtmlgoodies_tabObj['dhtml_tabView1'].getElementsByTagName('DIV')[0].appendChild(aTab);
 	var span = document.createElement('SPAN');
			span.innerHTML = '导出数据';
			span.style.position = 'relative';
			aTab.appendChild(span);
			var img = document.createElement('IMG');
			img.valign = 'bottom';
			img.src = '../../inc/tab/images/tab_right_inactive.gif';
			// IE5.X FIX
			if((navigatorVersion && navigatorVersion<6) || (MSIE && !strictDocType)){
				img.style.styleFloat = 'none';
				img.style.position = 'relative';
				img.style.top = '4px'
				span.style.paddingTop = '4px';
				aTab.style.cursor = 'hand';
			}	// End IE5.x FIX
			aTab.appendChild(img);
 
  _tb1=new DataGrid("tableDiv","scrollTable",{});

	var treeItem=window.parent.document.frames['lfefFrame'].getSelectedItemData();
	if(treeItem!=null){
	_last_custInfo=treeItem.data;
	initActiveTab();
	
	}
	}
	
function coverdivIsShow(isShow){
 if(typeof(isShow)=="undefined"||isShow==null||isShow==false){
  document.getElementById("coverdiv").style.display="none";
  document.getElementById("coverdiv-loading").style.display="none";
 }else{
  document.getElementById("coverdiv").style.display="block";
  document.getElementById("coverdiv-loading").style.display="block";
 }
}	

function printData(){
var custInfo=_last_custInfo;
if (custInfo==null){
alert("请选择一个客户");
return;
}

var custId=custInfo.custId;
var dataType=custInfo.dataType;
var advQueryC=" where cust_id='"+custId+"' ";
   if(dataType=="1"){
     advQueryC = " where cust_id='"+custId+"' and buz_type='"+custInfo.custName+"' ";
   }else if(dataType=="2"){
     advQueryC=" where circuit_id='"+custInfo.circuitId+"' and cust_id='"+custId+"'";
     
   } 
var advQueryC2=" where cust_id='"+custId+"' ";
  
    if(custInfo.buzType!=null && custInfo.buzType!="_ALL_TYPE_CIR")
      advQueryC2+=" and buz_type='"+custInfo.buzType+"' "; 
    if(custInfo.circuitId!=null && custInfo.circuitId.length>0)
       advQueryC2+=" and circuit_Id='"+custInfo.circuitId+"' ";  
       


document.getElementById('form1').action=document.getElementById('form1').action+"&advQueryC="+advQueryC+"&advQueryC2="+advQueryC2;
document.getElementById('form1').submit();
}
</script>
